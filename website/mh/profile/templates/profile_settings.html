{% extends "profile_base.html" %}

{% block title %} {{user.username}} - Profile Settings {% endblock %}

{% block content %}

    <h1>Profile Settings</h1><br>

    <div class="formList">
        <h3>Manage Instruments:</h3><br>
        <select id="instrument_select" class="form-control" onchange="GetSelectedObject('instrument');">
            <option value="Add New" selected> + Add New</option>
            {% for inst in user.GetInstruments() %}
                <option value="{{inst.id}}">{{inst.instrument}}</option>
            {% endfor %}
        </select>
        <hr>
        <form method="POST" action="{{url_for('profile.HandleNewInstrument')}}" id="instrument_add">
            <div class="form-group">
                <label for="instrument_search">Begin typing the instrument's name and then select from the options below</label>
                <div class="input-group">
                    <input type="text" class="form-control" name="instrument_search" placeholder="Instrument name..." id="instrument_search"  onkeyup="Get('instrument')">
                    <button class="btn btn-outline-danger" type="button" onclick="Clear('instrument')">Clear Instrument</button>
                </div>
                <p class="AddedInstruments" id="added_instrument">Added instrument: {% if user.instruments %}{{user.instruments}}{% endif %}</p>
                <div id="searchResults_instrument"></div>
                <a href="/help/missing#instrument" id="instrument_missing" style="display: none;">Missing instruments? Let us know!</a><br>
                <input type="hidden" id="instruments" name="instruments" class="false">
                
                <div class="form-group">
                    <label for="year">Enter the year you started playing:</label>
                    <input type="number" name="year" min="1900" max="{{year}}" step="1" value="{{year}}" required class="required">
                </div>
                <div class="form-group">
                    <label for="level">Enter your grading/level, if applicable:</label>
                    <input type="text" class="form-control" name="level" placeholder="Enter your grade/level...">
                </div>
                <div class="form-group">
                    <label for="details">Enter any additional details:</label>
                    <textarea name="details" placeholder="Enter any additional details..." class="form-control" rows="2"></textarea>
                </div>
                <input type="submit" class="btn btn-outline-success" value="Add" onclick="return checkEntered('instrument')"> 
            </div>
        </form>
        {% for inst in user.GetInstruments() %}
            <form method="POST" action="{{url_for('profile.HandleUpdateInstrument')}}" style="display:none;" id="instrument_{{inst.id}}">
                <div class="form-group">
                    <div class="form-group">
                        <label for="instrument_search">Selected instrument:</label>
                        <input type="text" class="form-control" disabled value="{{inst.instrument}}">
                        <input type="hidden" name="instruments" value="{{inst.instrument}}">
                    </div>
                    
                    <div class="form-group">
                        <label for="year">Enter the year you started playing:</label>
                        <input type="number" name="year" min="1900" max="{{year}}" step="1" required value="{{inst.year}}" class="required">
                    </div>
                    <div class="form-group">
                        <label for="level">Enter your grading/level, if applicable:</label>
                        <input type="text" class="form-control" name="level" placeholder="Enter your grade/level..." {% if inst.level %}value="{{inst.level}}"{% endif %}>
                    </div>
                    <div class="form-group">
                        <label for="details">Enter any additional details:</label>
                        <textarea name="details" placeholder="Enter any additional details..." class="form-control" rows="2">{% if inst.details %}{{inst.details}}{% endif %}</textarea>
                    </div>
                    <input type="submit" class="btn btn-outline-danger" value="Delete" name="delete"> 
                    <input type="submit" class="btn btn-outline-success" value="Update"> 
                </div>
            </form>
        {% endfor %}
    </div>
    
    <script>
        window.onload = function() {
            window["dict"] = ReloadDict();
            window["user_"] = {
                "instrument": JSON.parse('{{user_instruments | tojson | safe}}'),
            };
        }

        function ReloadDict() {
            console.log("Reloaded.");
            return {
                "instrument": Filter("{{instruments}}"),
            };
        }
    </script>
    <script src="{{url_for('profile.static', filename='autofiller.js')}}"></script>
    <script src="{{url_for('profile.static', filename='selection.js')}}"></script>
{% endblock %}